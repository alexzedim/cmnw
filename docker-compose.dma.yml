version: '3.8'
services:
  dma:
    image: ghcr.io/alexzedim/dma:latest
    restart: always
    command: [ 'node', '--max-old-space-size=4096', 'dist/apps/dma/main.js' ]
    deploy:
      mode: replicated
      replicas: ${DMA_REPLICAS:-2}
    environment:
      - AUCTIONS_WORKER_CONCURRENCY=${AUCTIONS_WORKER_CONCURRENCY:-1}
    env_file:
      - stack.env

  market:
    image: ghcr.io/alexzedim/dma:latest
    restart: always
    command: [ 'node', 'dist/apps/market/main.js' ]
    env_file:
      - stack.env

  items:
    image: ghcr.io/alexzedim/dma:latest
    restart: always
    command: [ 'node', 'dist/apps/items/main.js' ]
    environment:
      - ITEMS_WORKER_CONCURRENCY=${ITEMS_WORKER_CONCURRENCY:-3}
    env_file:
      - stack.env
